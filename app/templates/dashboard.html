{% extends "base.html" %}

{% block title %}SPECTER WATCH - Dashboard{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; color: var(--accent-green);">SPECTER WATCH Dashboard</h1>

<!-- Stats Overview -->
<div class="grid" style="margin-bottom: 2rem;">
    <div class="stat-box">
        <div class="stat-value">{{ stats.active_watches }}</div>
        <div class="stat-label">Active Watches</div>
    </div>
    <div class="stat-box">
        <div class="stat-value warning">{{ stats.triggered_watches }}</div>
        <div class="stat-label">Triggered Watches</div>
    </div>
    <div class="stat-box">
        <div class="stat-value">{{ stats.recent_reports }}</div>
        <div class="stat-label">Reports (7 days)</div>
    </div>
</div>

<div class="grid">
    <!-- Active Watches -->
    <div class="card">
        <div class="card-header">Active Watches</div>
        {% if active_watches %}
        <table>
            <thead>
                <tr>
                    <th>Earthquake</th>
                    <th>Mag</th>
                    <th>Piezo %</th>
                    <th>Expires</th>
                </tr>
            </thead>
            <tbody>
                {% for watch in active_watches %}
                <tr>
                    <td>
                        <a href="/watch/{{ watch.id }}" style="color: var(--text-primary);">
                            {{ watch.eq_place or 'Unknown location' }}
                        </a>
                    </td>
                    <td>M{{ watch.eq_magnitude }}</td>
                    <td>
                        <span class="score {% if watch.piezo_probability >= 0.7 %}score-high{% elif watch.piezo_probability >= 0.4 %}score-medium{% else %}score-low{% endif %}">
                            {{ (watch.piezo_probability * 100)|int }}%
                        </span>
                    </td>
                    <td>{{ watch.watch_end.strftime('%m/%d %H:%M') if watch.watch_end else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--text-secondary);">No active watches</p>
        {% endif %}
    </div>

    <!-- Triggered Watches -->
    <div class="card">
        <div class="card-header">Recently Triggered</div>
        {% if triggered_watches %}
        <table>
            <thead>
                <tr>
                    <th>Earthquake</th>
                    <th>Mag</th>
                    <th>Piezo %</th>
                </tr>
            </thead>
            <tbody>
                {% for watch in triggered_watches %}
                <tr>
                    <td>
                        <a href="/watch/{{ watch.id }}" style="color: var(--accent-yellow);">
                            {{ watch.eq_place or 'Unknown location' }}
                        </a>
                    </td>
                    <td>M{{ watch.eq_magnitude }}</td>
                    <td>
                        <span class="score score-high">
                            {{ (watch.piezo_probability * 100)|int }}%
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--text-secondary);">No triggered watches yet</p>
        {% endif %}
    </div>
</div>

<div class="grid">
    <!-- High Score Reports -->
    <div class="card">
        <div class="card-header">High SPECTER Score Reports</div>
        {% if high_score_reports %}
        <table>
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Shape</th>
                    <th>Score</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for report in high_score_reports %}
                <tr>
                    <td>{{ report.city }}, {{ report.state }}</td>
                    <td>{{ report.shape or 'Unknown' }}</td>
                    <td>
                        <span class="score {% if report.specter_score >= 70 %}score-high{% elif report.specter_score >= 40 %}score-medium{% else %}score-low{% endif %}">
                            {{ report.specter_score|int }}
                        </span>
                    </td>
                    <td>{{ report.datetime.strftime('%m/%d/%Y') if report.datetime else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--text-secondary);">No high-score reports found</p>
        {% endif %}
    </div>

    <!-- Recent Earthquakes -->
    <div class="card">
        <div class="card-header">Recent M3.0+ Earthquakes</div>
        {% if recent_earthquakes %}
        <table>
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Mag</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for eq in recent_earthquakes %}
                <tr>
                    <td>{{ eq.place or 'Unknown' }}</td>
                    <td>M{{ eq.magnitude }}</td>
                    <td>{{ eq.datetime.strftime('%m/%d %H:%M') if eq.datetime else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--text-secondary);">No recent earthquakes</p>
        {% endif %}
    </div>
</div>

<!-- System Status -->
<div class="card">
    <div class="card-header">System Status</div>
    <p style="color: var(--accent-green);">System Online</p>
    <p style="color: var(--text-secondary); margin-top: 0.5rem;">
        Last updated: {{ now.strftime('%Y-%m-%d %H:%M:%S UTC') }}
    </p>
</div>
{% endblock %}
